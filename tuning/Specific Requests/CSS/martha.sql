--Tr.35670 - Please void drops on accounts
set serveroutput on;
DECLARE
CURSOR get_gas IS
SELECT KY_BA 
from bill_acct where ky_ba in (
585765000,8840255001,8498225002,5717705000,9067294007,1227264003,8443234006,
3564714006,823204002,9185273008,3503206007,1441725007,6795213004,4494283004,
3952732001,1364222007,3632291003,4514771007,4907261003,4033785003,2290232005,
4700711006,3943201002,2506780009,3237270006,6999750002,8480240004,5549210009,
1603800005,7421289006,6070769001,1454275007,2320778007,8721272008,5955752007,
6919242001,7539281007,5106251008,9670221001,55701007,5657290004,8350770006,
8590260001,4376740004,6778230001,9946237000,2474710008,208200006,3407789005,
5572279009,1359759006,3663249002,5169729001,2366219009,841717002,564288008,
9302770000,2681258008,4736738000,8861708007,7510297003,3356777004,4841747004,
8130717009,6272207008,8272756008,5560246009,547726009,5568216003,4638796008,
3012285007,4022701000,2576299004,3148779009,6340272000,419750002,5822239006,
9609719001,9491209001,2533758004,3681248003,7581728008,2470218003,1221010001,
594797001,7361767005,1089737003,7636228000,9729296001,7248776004,8883266008,
8550746004,6574236003,2618716002,1535206002,619755001,3097266006,6481245001,
4863725002,8161794009,747284000,5767764004,1868746008,3953255003,1141734000,
5996224004,6674704008,5753293001,5020233000,1750714009,3699203009,2241008008,
7035587008,4845077003,9170557006,6033048007,3693017009,5088596002,5693086006,
5977566005,9013536009,5345026007,9943095000,8196575003,6209545000,5936035009,
6712005006,2574074009,7874525002,9693015001,720593000,229083005,5974563002,
9092533008,695023002,4427503002,3349092005,6422572009,1735062004,9104542000,
4037032003,2296002001,5011581002,1017174007,6544072000,4751551009,8997041002,
2583521002,790012001,5113085005,8307055007,9068025006,7052505000,4660094006,
3814574003,9530544005,7818034004,1561004001,2266554001,6896523001,2571592000,
8006562007,4540532003,9890022008,6261502001,7201091006,3145571001,4181061007,
406031007,5941511007,5437001007,7080580004,1213070002,3981550004,1359042006,
8681520005,4186090008,6232059000,4449029005,4339509003,6328098000,184069001,
4995548004,5584003006,429552009,1056042008,7494522009,6463012004,2896592002,
3505081008,6971051006,9768021002,4429090008,8050000003,3251589002,3441079002,
5065559001,9754049001,6933530008,6611020007,1771538009,4747028006,3019508003,
2609098000,4878577009,3939007005,75586006,7198556005,5172046002,6422526007,
3881776006,3424016001,5250595008,8442531006,9672020002,6503099005,2052579005,
1887707003,8891069004,4103519002,5199009003,108603005,9872078002,6137558006,
430048007,1989528002,2479018009,3413599008,9242087000,5340567003,3178057007,
9161537005,9459027009,1215507002,5981576000,4667066000,8251546002,5791036000,
9579516009,1980076007,9573045001,3731525002,5079015003,8989594003,2709084008,
3223564004,9672054008,317024007,4869504007,8404093007,9227544004,9971033001,
4786557000,9666017008,7719087007,2921536005,3801026007,323227005,9403506006,
5591095005,7503065000,9468545001,7049035008,3614515000,4425006000,4340584003,
1333074008,2295554006,1632044002,3673525000,1554593002,880083009,3839054002,
4953533003,5127023004,3138503002,2152572008,279062001,9558542009,210032009,
1583513009,3398584009,443071001,388551004,161042002,252521001,4496011006,
8341590009,5835560001,3199050008,8141683005,1110173004,6559653008,4423623003,
4893113001,9185697008,7693152007,3798632008,6340122005,7134602008,254191001,
3507671000,5036161006,2848641003,7648131003,5073102007,4080680006,8962172003,
5801650005,9255140007,2867112009,7492699007,4002190001,4586669001,5828639000,
638130006,9508198006,1382678007,9996168005,553648007,7853138009,343618002,
7004108004,5615077001
)
;
--FROM ls1;
-- select cd_so_stat from SERV_ord where ky_ba =          make 50/54 --> 57 [void].
--select ky_ba,cd_so_stat from serv_ord where ky_ba in (4476802001,4434327003,8193530002);
errmesg         sr_errors.error_mesg%type;
gas             get_gas%rowtype;
bill_ind        VARCHAR2(1) := 'N';
kypremno        serv_ord.ky_prem_no%type;  
TSKYPWQ         serv_ord.TS_KY_PWQ%type;
count_in        NUMBER(10) := 0;
count_so        NUMBER(10) := 0;
count_som        NUMBER(10) := 0;
count_wfm        NUMBER(10) := 0;
error_flag      VARCHAR2(1) := 'N';
newdt           VARCHAR2(10) := ' ';

BEGIN

   FOR gas in get_gas  LOOP
      count_in := count_in + 1;
      BEGIN
         SELECT ky_prem_no, TS_KY_PWQ INTO kypremno, TSKYPWQ
             FROM serv_ord 
--            WHERE KY_BA = gas.ky_ba and cd_so_stat = '57' and dt_stat = '2003-12-23'; 
-- and dt_eff_ele_serv > '2004' ;
         -- WHERE KY_BA = gas.ky_ba and cd_so_stat = '54';
         WHERE KY_BA = gas.ky_ba and cd_so_stat = '50';
      EXCEPTION                  
         WHEN OTHERS THEN
            errmesg := SUBSTR('ERROR select kypremno: '||gas.ky_ba||' '||SQLERRM(SQLCODE),1,250);
            dbms_output.put_line(errmesg);
      END;


     BEGIN
         UPDATE serv_ord set cd_so_stat = '57'
       --  where KY_BA = gas.ky_ba and cd_so_stat = '54';
         where KY_BA = gas.ky_ba and cd_so_stat = '50';
--         UPDATE serv_ord set cd_so_stat = '50'
--         where KY_BA = gas.ky_ba and cd_so_stat = '57' and dt_stat = '2003-12-23';
--          and dt_eff_ele_serv > '2004';
         count_so := count_so + 1;
      EXCEPTION
         WHEN OTHERS THEN
            errmesg := SUBSTR('ERROR update SO '||SQLERRM(SQLCODE),1,250);
            dbms_output.put_line(errmesg);
      END;



     BEGIN
         UPDATE so_mtr_pt set cd_stat = 1
         where KY_prem_no = kypremno and cd_stat = 2;
--         UPDATE so_mtr_pt set cd_stat = 2
--         where KY_prem_no = kypremno and cd_stat = 1 and dt_stat > '2003-12';
         count_som := count_som + 1;
      EXCEPTION
         WHEN OTHERS THEN
            errmesg := SUBSTR('ERROR update SO_mtr_pt '||gas.ky_ba||SQLERRM(SQLCODE),1,250);
            dbms_output.put_line(errmesg);
      END;


/****************                                    
     BEGIN
         UPDATE pwq_dir set cd_wo_stat = '04'
         where TS_KY_PWQ = TSKYPWQ and cd_wo_stat = '07';
--         UPDATE pwq_dir set cd_wo_stat = '07'
--         where TS_KY_PWQ = TSKYPWQ and cd_wo_stat = '04';
         count_wfm := count_wfm + 1;
     EXCEPTION
         WHEN OTHERS THEN
            errmesg := SUBSTR('ERROR update pwq_dir '||gas.ky_ba||SQLERRM(SQLCODE),1,250);
            dbms_output.put_line(errmesg);
     END;
*******/

      END LOOP;

dbms_output.put_line('count_in: '||count_in);
dbms_output.put_line('count_so: '||count_so);
dbms_output.put_line('count_som: '||count_som);
dbms_output.put_line('count_wfm: '||count_wfm);
   --COMMIT;
END;
/