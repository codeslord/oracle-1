REM set timing on;
REM SHOW PARAMETER OPTIMIZER_MODE


alter session set optimizer_mode = CHOOSE;
--alter session set optimizer_mode = RULE;



DELETE plan_table where statement_id = 'MTI'
/

EXPLAIN PLAN
  SET STATEMENT_ID = 'MTI'
  INTO plan_table
  FOR
--SELECT * FROM (
--SELECT /*+ FIRST_ROWS(500) */ ACCTS.*, ROWNUM ROW_POSITION FROM (
SELECT 
	PPLSCIS.EDI_TRANSACTION.ID_EDI_TRANSACTION, 
	PPLSCIS.EDI_FILE_HEADER.CD_TRANS_DIRECTION, 
	PPLSCIS.EDI_FILE_HEADER.CD_COMM_CHANNEL, 
	PPLSCIS.EDI_FILE_HEADER.CD_EDI_FILE_TYPE, 
	PPLSCIS.EDI_TRANSACTION.TX_UTILITY_NUM, 
	PPLSCIS.EDI_TRANSACTION.TX_OLD_UTILITY_NUM, 
	PPLSCIS.EDI_TRANSACTION.TX_UTILITY_DD4, 
	PPLSCIS.EDI_TRANSACTION.TX_SUPPLIER_NUM, 
	PPLSCIS.EDI_TRANSACTION.TX_SUPPLIER_DD4, 
	PPLSCIS.EDI_TRANSACTION.TX_CUSTOMER_NAME, 
	PPLSCIS.EDI_TRANSACTION.TX_TRANS_REF_NUM, 
	PPLSCIS.EDI_TRANSACTION.TX_XREF_NUM, 
	PPLSCIS.EDI_TRANSACTION.CD_TRANS_TYPE, 
	PPLSCIS.EDI_TRANSACTION.CD_TRANS_SUB_TYPE, 
	PPLSCIS.EDI_TRANSACTION.CD_TRANS_SUB_TYPE_RAW, 
	PPLSCIS.EDI_TRANSACTION.CD_STATE, 
	PPLSCIS.EDI_TRANSACTION.CD_REQ_RESP, 
	PPLSCIS.EDI_TRANSACTION.CD_SERVICE_TYPE, 
	PPLSCIS.EDI_TRANSACTION.CD_PURPOSE_CODE, 
	PPLSCIS.EDI_HEADER.TX_ISA_CONTROL_NUM, 
	PPLSCIS.EDI_FUNC_GROUP.TX_GS_CONTROL_NUM, 
	PPLSCIS.EDI_FUNC_GROUP.DT_GS_DATE, 
	PPLSCIS.EDI_FILE_HEADER.DT_TRANS_DATE, 
	PPLSCIS.EDI_TRANSACTION.DT_MISC_DATE_1, 
	PPLSCIS.EDI_TRANSACTION.DT_DATE_EFFECTIVE_OR_DUE, 
	PPLSCIS.EDI_TRANSACTION.DT_START_DATE, 
	PPLSCIS.EDI_TRANSACTION.DT_END_DATE, 
	PPLSCIS.EDI_TRANSACTION.CD_ACCEPT_REJECT, 
	PPLSCIS.EDI_TRANSACTION.CD_ACTION_CODE, 
	PPLSCIS.EDI_TRANSACTION.TX_UTILITY_NAME, 
	PPLSCIS.EDI_TRANSACTION.TX_SUPPLIER_NAME, 
	PPLSCIS.EDI_TRANSACTION.NO_TRANS_BYTE_START_POS, 
	PPLSCIS.EDI_TRANSACTION.NO_TRANS_BYTE_END_POS, 
	PPLSCIS.EDI_FILE_HEADER.ID_FILENET_DOC_GUID, 
	PPLSCIS.EDI_FILE_HEADER.CD_BUSINESS_UNIT, 
	PPLSCIS.EDI_FILE_HEADER.TX_FILENAME, 
	PPLSCIS.EDI_HEADER.NO_RECORD_DELIMITER_UTF8, 
	PPLSCIS.EDI_REASON.CD_REASON, 
	PPLSCIS.EDI_TRANSACTION.CD_BILL_PRESENTER, 
	PPLSCIS.EDI_TRANSACTION.CD_BILL_CALCULATOR
FROM 
	PPLSCIS.EDI_FILE_HEADER 
	JOIN PPLSCIS.EDI_HEADER ON PPLSCIS.EDI_HEADER.ID_EDI_FILE_HEADER = PPLSCIS.EDI_FILE_HEADER.ID_EDI_FILE_HEADER 
	JOIN PPLSCIS.EDI_FUNC_GROUP ON PPLSCIS.EDI_FUNC_GROUP.ID_EDI_HEADER = PPLSCIS.EDI_HEADER.ID_EDI_HEADER 
	JOIN PPLSCIS.EDI_TRANSACTION ON PPLSCIS.EDI_TRANSACTION.ID_EDI_FUNC_GROUP = PPLSCIS.EDI_FUNC_GROUP.ID_EDI_FUNC_GROUP 
	--LEFT JOIN PPLSCIS.EDI_REASON ON PPLSCIS.EDI_REASON.ID_EDI_TRANSACTION = PPLSCIS.EDI_TRANSACTION.ID_EDI_TRANSACTION
  JOIN PPLSCIS.EDI_REASON ON PPLSCIS.EDI_REASON.ID_EDI_TRANSACTION = PPLSCIS.EDI_TRANSACTION.ID_EDI_TRANSACTION
WHERE  PPLSCIS.EDI_FILE_HEADER.CD_BUSINESS_UNIT = 'PPLSolutions'
  AND  PPLSCIS.EDI_TRANSACTION.TX_UTILITY_DD4  IN ('007924772', '007923311', '007911050EDC', '043381565EDC', '006936017', '006971618NJ', '156171464', 'BGEGAS', '006949002', '006951552', '006953665', '957877905', '006993695', '006948954', '041952581', '003407236', '007900293', '006929509', '006953848', '006982359', '006982359', '006917090', '175206614', '147212336', '006971618DE', 'CNCTVGAS', '006971618MD', '006957872', '000000000MD', '000000000PA', '008781668', '006999189', '007915606', '056711344', '006954317', '888888888', '007916836', '008967614', '006973358', '069912840', '006952626', '007998644', '001193655', '008819492', '061843553', '006994735', '006994735', '006927792', '006936306', '002778090', '006977763', '006998371', '006993406', '007914468', '007914468', '007912736', '006932115', '006920284DC', '830931239', '006920284', '007909427AC', '006973812GASP', '006973812', '006971352', '999999999', '160612110', '617976758', '105262336', '051409605', '007929441', '007904626', '1039940674000', '099427866', '799376595', '007912967','007912967MD', '079167763', '006917967', '003789070', '006956551')
  AND  PPLSCIS.EDI_TRANSACTION.CD_STATE  IN ('CA', 'CT', 'DC', 'DE', 'IL', 'MA', 'MD', 'ME', 'MI', 'MT', 'NH', 'NJ', 'NY', 'OH', 'PA', 'RI', 'TX')
  --AND  TRUNC(PPLSCIS.EDI_FILE_HEADER.DT_TRANS_DATE)  >= '02-Jul-2011' 
--)) ACCTS WHERE ROWNUM <= 500   
--      ORDER BY ID_EDI_TRANSACTION DESC
/
      --)         
--      WHERE  ROW_POSITION > 0

@utlxpls.sql